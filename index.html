<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–û—Å–Ω–æ–≤—ã –ò–ò ‚Äî –û–Ω–ª–∞–π–Ω –∫—É—Ä—Å</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary: #FF7A00;
      --primary-light: #FF9E40;
      --white: #FFFFFF;
      --dark: #333333;
      --gray: #F5F5F5;
      --graphite: #4A4A4A;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
      outline: none;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #FFF3E0 0%, #FFFFFF 100%);
      color: var(--dark);
      min-height: 100vh;
    }

    /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, var(--white) 0%, #FFF3E0 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }

    .loading-text {
      font-size: 20px;
      font-weight: 500;
      margin-bottom: 20px;
      color: var(--primary);
    }

    .loading-balls {
      display: flex;
      gap: 12px;
    }

    .loading-ball {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      animation: bounce 1s infinite ease-in-out;
    }

    .loading-ball:nth-child(1) {
      background: var(--primary);
      animation-delay: 0s;
    }

    .loading-ball:nth-child(2) {
      background: var(--primary-light);
      animation-delay: 0.2s;
    }

    .loading-ball:nth-child(3) {
      background: #AAAAAA;
      animation-delay: 0.4s;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #app-content {
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .header {
      display: flex;
      align-items: center;
      background: var(--graphite);
      padding: 20px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      width: 100%;
      margin-bottom: 20px;
      position: relative;
      color: var(--white);
    }

    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin-right: 20px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-size: 20px;
      font-weight: 600;
      color: var(--white);
      margin-bottom: 4px;
      line-height: 1.2;
    }

    .user-id {
      font-size: 14px;
      color: #DDD;
    }

    .content {
      padding: 0 20px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .module {
      background: var(--white);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(255, 122, 0, 0.1);
      transition: all 0.3s ease;
      position: relative;
      cursor: pointer;
      margin-top: 30px;
    }

    .module:hover {
      transform: translateY(-5px);
    }

    .module.locked {
      opacity: 0.7;
      cursor: not-allowed;
    }

    .module-label {
      position: absolute;
      top: -20px;
      left: 0;
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      z-index: 2;
    }

    .module-content {
      position: relative;
    }

    .module-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--dark);
    }

    .module-desc {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
      line-height: 1.4;
    }

    .module-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
    }

    .module-btn:hover {
      background: var(--primary-light);
    }

    .module.locked .module-btn {
      background: #ccc;
      cursor: not-allowed;
    }

    .lock-icon {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 20px;
    }

    /* Menu Button Styles */
    .menu-button {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      background: transparent;
      border: 2px solid var(--white);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 6px;
      z-index: 100;
      padding: 8px;
    }

    .menu-button span {
      display: block;
      width: 24px;
      height: 2px;
      background: var(--white);
      transition: all 0.3s ease;
    }

    .menu-button.active span:nth-child(1) {
      transform: rotate(45deg) translate(6px, 6px);
    }

    .menu-button.active span:nth-child(2) {
      opacity: 0;
    }

    .menu-button.active span:nth-child(3) {
      transform: rotate(-45deg) translate(6px, -6px);
    }

    /* Menu Content */
    .menu-content {
      position: absolute;
      top: 80px;
      right: 20px;
      background: var(--white);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 99;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .menu-content.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .menu-content button {
      background: linear-gradient(135deg, #FFF3E0 0%, #FFFFFF 100%);
      border: none;
      padding: 12px 24px;
      width: 100%;
      text-align: left;
      cursor: pointer;
      color: var(--dark);
      font-size: 16px;
      transition: background 0.2s;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .menu-content button:hover {
      background: var(--gray);
    }

    /* Chat Widget */
    .chat-widget {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(255, 122, 0, 0.2);
      transition: transform 0.3s ease;
      z-index: 1000;
      text-decoration: none;
      padding: 8px;
      gap: 2px;
    }

    .chat-widget:hover {
      transform: scale(1.1);
    }

    .chat-widget .ai-text {
      color: var(--white);
      font-size: 14px;
      font-weight: bold;
      line-height: 1;
    }

    .chat-widget .chat-icon {
      font-size: 18px;
      color: var(--white);
      line-height: 1;
    }

    @media (max-width: 600px) {
      .header {
        padding: 15px;
      }
      
      .avatar {
        width: 48px;
        height: 48px;
        margin-right: 15px;
      }

      .user-name {
        font-size: 18px;
      }

      .content {
        padding: 0 15px 15px;
      }

      .modules-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="loading-screen" id="loading-screen">
    <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞</div>
    <div class="loading-balls">
      <div class="loading-ball"></div>
      <div class="loading-ball"></div>
      <div class="loading-ball"></div>
    </div>
  </div>

  <div id="app-content">
    <div class="header">
      <div class="avatar" id="userAvatar">
        <span id="avatar-fallback">U</span>
      </div>
      <div class="user-info">
        <div class="user-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="user-id" id="userId">ID: –∑–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
      <button class="menu-button" id="menuButton">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="menu-content" id="menuContent">
        <button id="supportButton">–¢–µ—Ö. –ø–æ–¥–¥–µ—Ä–∂–∫–∞ üõ†Ô∏è</button>
      </div>
    </div>

    <div class="content">
      <div class="modules-grid" id="modules-container">
        <!-- –ú–æ–¥—É–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </div>
    </div>

    <a href="chat.html" class="chat-widget">
      <span class="ai-text">AI</span>
      <span class="chat-icon">üí¨</span>
    </a>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Puzzle Bot
    const PUZZLE_CONFIG = {
      // API —Ç–æ–∫–µ–Ω –∏–∑ Puzzle Bot (–ù–∞—Å—Ç—Ä–æ–π–∫–∏ -> –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
      API_TOKEN: 'i5vkuteSbTI65FSFoLahqgpEmpkQUbZJ',

      // ID –±–æ—Ç–∞
      BOT_CHAT_ID: '7533493609',

      // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø
      PAID_CATEGORY: '–¢–ï–°–¢',

      // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
      CHECK_INTERVAL: 5000  // 5 —Å–µ–∫—É–Ω–¥
    };

    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const state = {
      userId: null,
      username: null,
      isPaid: false,
      isLoaded: false
    };

    // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ª–æ–≥–æ–≤ –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
      const logContainer = document.createElement('div');
      logContainer.id = 'debug-log';
      logContainer.style.position = 'fixed';
      logContainer.style.bottom = '0';
      logContainer.style.left = '0';
      logContainer.style.right = '0';
      logContainer.style.maxHeight = '200px';
      logContainer.style.background = 'rgba(0, 0, 0, 0.8)';
      logContainer.style.color = '#fff';
      logContainer.style.fontFamily = 'monospace';
      logContainer.style.fontSize = '12px';
      logContainer.style.padding = '10px';
      logContainer.style.overflowY = 'auto';
      logContainer.style.zIndex = '1000';
      document.body.appendChild(logContainer);

      // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è URL
      const style = document.createElement('style');
      style.textContent = `
        .debug-log-entry { margin: 4px 0; padding: 4px; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .debug-log-entry.error { color: #ff6b6b; }
        .debug-log-entry.success { color: #69db7c; }
        .debug-log-entry.warning { color: #ffd43b; }
        .api-url { 
          background: rgba(255,255,255,0.1); 
          padding: 8px; 
          margin: 4px 0;
          border-radius: 4px;
          word-break: break-all;
          cursor: pointer;
        }
        .api-url:hover {
          background: rgba(255,255,255,0.2);
        }
      `;
      document.head.appendChild(style);
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    function log(message, type = 'info', isUrl = false) {
      const logContainer = document.getElementById('debug-log');
      const entry = document.createElement('div');
      entry.className = `debug-log-entry ${type}`;
      const time = new Date().toLocaleTimeString();

      if (isUrl) {
        entry.innerHTML = `[${time}] API URL (–Ω–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):<br><div class="api-url">${message}</div>`;
        entry.querySelector('.api-url').addEventListener('click', () => {
          navigator.clipboard.writeText(message).then(() => {
            log('‚úÖ URL —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
          });
        });
      } else {
        entry.textContent = `[${time}] ${message}`;
      }

      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;

      while (logContainer.children.length > 50) {
        logContainer.removeChild(logContainer.firstChild);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
    function hideLoadingScreen() {
      const loadingScreen = document.getElementById('loading-screen');
      loadingScreen.style.opacity = '0';
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        document.getElementById('app-content').style.opacity = '1';
      }, 500);
    }

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async function checkUserCategories() {
      try {
        const url = 'https://api.puzzlebot.top/?token=i5vkuteSbTI65FSFoLahqgpEmpkQUbZJ&method=getUserInChatStatus&user_id=1515638372&chat_id=7533493609&page=1';
        
        const response = await fetch(url, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        
        // –í—ã–≤–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ –≤ —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ, –∫–∞–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
        console.log(JSON.stringify(data));
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤—ã–≤–æ–¥–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
        if (data.code === 0 && data.data && data.data.categories) {
          console.log('–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', data.data.categories);
        }

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ:', error);
      }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    function validateConfig() {
      if (!PUZZLE_CONFIG.API_TOKEN) {
        log('–û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω API —Ç–æ–∫–µ–Ω!', 'error');
        return false;
      }
      if (!PUZZLE_CONFIG.BOT_CHAT_ID) {
        log('–û—à–∏–±–∫–∞: –Ω–µ —É–∫–∞–∑–∞–Ω ID –±–æ—Ç–∞!', 'error');
        return false;
      }
      return true;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    document.addEventListener('DOMContentLoaded', async () => {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
      document.getElementById('loading-screen').style.display = 'flex';
      document.getElementById('app-content').style.opacity = '0';

      if (window.Telegram?.WebApp) {
        await initTelegramApp();
      } else {
        await initTestMode();
      }

      // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π
      await checkUserCategories();
      setInterval(checkUserCategories, PUZZLE_CONFIG.CHECK_INTERVAL);
    });

    async function initTelegramApp() {
      // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∑–∞—Å—Ç–∞–≤–∫—É Telegram
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
      }

      const tg = window.Telegram.WebApp;
      const user = tg.initDataUnsafe.user;
      
      state.userId = user.id.toString();
      state.username = user.username || null;

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
      document.getElementById('userName').textContent = 
        [user.first_name, user.last_name].filter(Boolean).join(' ') || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      document.getElementById('userId').textContent = `ID: ${state.userId}`;

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä
      const avatarElement = document.getElementById('userAvatar');
      if (user.photo_url) {
        const img = new Image();
        img.src = user.photo_url;
        img.onload = () => {
          avatarElement.innerHTML = '';
          avatarElement.appendChild(img);
        };
      } else {
        const fallback = user.first_name?.charAt(0).toUpperCase() || 'U';
        document.getElementById('avatar-fallback').textContent = fallback;
      }

      state.isLoaded = true;
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–æ–¥—É–ª–∏ —Å—Ä–∞–∑—É, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –µ—â–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω
      updateUI();
      hideLoadingScreen();
    }

    async function initTestMode() {
      state.userId = "test-user";
      document.getElementById('userName').textContent = '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      document.getElementById('userId').textContent = 'ID: test-user';
      document.getElementById('avatar-fallback').textContent = 'T';
      state.isLoaded = true;
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –º–æ–¥—É–ª–∏ —Å—Ä–∞–∑—É, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –µ—â–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω
      updateUI();
      hideLoadingScreen();
    }

    function updateUI() {
      console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI, —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã:', state.isPaid); // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      const modules = [
        { id: 0, title: "–í–≤–µ–¥–µ–Ω–∏–µ –≤ –ò–ò", desc: "–û—Å–Ω–æ–≤—ã, –∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞" },
        { id: 1, title: "–û—Å–Ω–æ–≤—ã ChatGPT", desc: "–ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å ChatGPT, –∫–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏" },
        { id: 2, title: "ChatGPT PRO", desc: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∏ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å ChatGPT" },
        { id: 3, title: "ChatGPT MASTER", desc: "–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ChatGPT" }
      ];

      let html = '';
      modules.forEach(module => {
        const isLocked = module.id !== 0 && !state.isPaid;
        html += `
