<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–¥—É–ª—å 0: –î–æ—Å—Ç—É–ø –∫ ChatGPT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    :root {
      --orange: #FF9800;
      --yellow: #FFF9C4;
      --white: #FFF;
      --text: #222;
      --gray: #F2F2F2;
      --header-gray: #E0E0E0;
      --transition: 0.6s cubic-bezier(.77,0,.18,1);
      --disabled: #CCCCCC;
      --blue: #4285F4;
      --success: #4CAF50;
      --error: #F44336;
      --warning: #FF9800;
      --info: #2196F3;
    }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      background: var(--white);
      color: var(--text);
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      line-height: 1.6;
    }
    /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ... */
  </style>
</head>
<body>
  <div class="splash" id="splash">
    <div style="position: absolute; top: 0.5rem; left: 0.5rem; width: 100%; display: flex;">
      <button class="exit-btn" id="splashExitBtn" title="–í—ã–π—Ç–∏"><span>&#8592;</span></button>
    </div>
    <h1>–ú–æ–¥—É–ª—å 0:<br>–î–æ—Å—Ç—É–ø –∫ ChatGPT</h1>
    <button id="startBtn">–ù–∞—á–∞—Ç—å</button>
  </div>

  <div class="main-content" id="mainContent">
    <div class="header-bar">
      <button class="exit-btn" id="exitBtn" title="–í—ã–π—Ç–∏"><span>&#8592;</span></button>
      <div class="progress-bar">
        <div class="progress-bar-inner" id="progressBar"></div>
      </div>
      <button class="report-btn" id="reportBtn" title="–°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ">üö©</button>
    </div>
    
    <div class="cards-container" id="cardsContainer"></div>
    
    <div class="buttons-container">
      <button class="next-btn centered" id="nextBtn">–î–∞–ª–µ–µ</button>
      <button class="guide-btn" id="guideBtn"><span class="emoji">üîó</span> –î–µ—Ç–∞–ª—å–Ω—ã–π –≥–∞–π–¥</button>
    </div>
    
    <div id="exitModal" style="display:none; position:fixed; z-index:100; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.25); align-items:center; justify-content:center;">
      <div style="background:#fff; border-radius:1.2rem; max-width:90vw; width:340px; padding:2rem 1.2rem; box-shadow:0 8px 32px #0002; text-align:center;">
        <div style="font-size:1.15rem; margin-bottom:1.5rem; color:#222;">–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏? –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.</div>
        <div style="display:flex; gap:1rem; justify-content:center;">
          <button id="modalExitBtn" style="background:linear-gradient(90deg, var(--orange), var(--yellow)); color:#222; border:none; border-radius:1.5rem; padding:0.7rem 1.5rem; font-weight:600; cursor:pointer;">–í—ã–π—Ç–∏</button>
          <button id="modalStayBtn" style="background:#eee; color:#222; border:none; border-radius:1.5rem; padding:0.7rem 1.5rem; font-weight:600; cursor:pointer;">–û—Å—Ç–∞—Ç—å—Å—è</button>
        </div>
      </div>
    </div>
  </div>

  <div class="completion-modal" id="completionModal">
    <div class="completion-content">
      <div class="checkmark">
        <div class="checkmark-circle">
          <div class="checkmark-icon">‚úì</div>
        </div>
      </div>
      <div class="completion-title">–ú–æ–¥—É–ª—å 0 –ø—Ä–æ–π–¥–µ–Ω!</div>
      <button class="completion-btn" id="completionBtn">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</button>
    </div>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è NocoDB
    const config = {
      orgs: 'weamcfo6',
      projectName: 'p27jdsmk69wuimh',
      tableName: 'mc6qh91f060pv4y',
      apiToken: 'bocQfycJpJsTG_tbwEf8ma8E5rhoig0njMDXFWtJ',
      apiVersion: 'v1'
    };

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const splash = document.getElementById('splash');
    const startBtn = document.getElementById('startBtn');
    const mainContent = document.getElementById('mainContent');
    const nextBtn = document.getElementById('nextBtn');
    const guideBtn = document.getElementById('guideBtn');
    const progressBar = document.getElementById('progressBar');
    const cardsContainer = document.getElementById('cardsContainer');
    const exitBtn = document.getElementById('exitBtn');
    const splashExitBtn = document.getElementById('splashExitBtn');
    const reportBtn = document.getElementById('reportBtn');
    const exitModal = document.getElementById('exitModal');
    const modalExitBtn = document.getElementById('modalExitBtn');
    const modalStayBtn = document.getElementById('modalStayBtn');
    const completionModal = document.getElementById('completionModal');
    const completionBtn = document.getElementById('completionBtn');

    // –ö–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–µ –±–ª–æ–∫–∏ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π)
    const contentBlocks = [
      {
        title: "–î–ê–í–ê–ô –ù–ê–ß–ù–ï–ú –ú–û–î–£–õ–¨ 0",
        image: "1.jpg",
        content: `–°–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏ –¥–∞–ª–µ–µ –≤ —ç—Ç–æ–º –º–æ–¥—É–ª–µ —Ç—ã –±—É–¥–µ—à—å –≤–∏–¥–µ—Ç—å <b>–≤—Ç–æ—Ä—É—é –∫–Ω–æ–ø–∫—É —Å –ø–æ–ª–Ω—ã–º –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–º –≥–∞–π–¥–æ–º</b>, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–µ–≥–æ –∫–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ.<br><br>
        <b>–°–û–í–ï–¢:</b> —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–ª–∏—Å—Ç–∞–π —ç—Ç–æ—Ç –º–æ–¥—É–ª—å —Ü–µ–ª–∏–∫–æ–º –¥–ª—è –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω–∏—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—Å—è —Ç–∞–∫, —á—Ç–æ –≥–∞–π–¥ —Ç–µ–±–µ –∏ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è`
      },
      {
        title: "–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï",
        content: `<span class="emoji">‚ùó</span> <b>–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ü–û–õ–£–ß–ò –î–û–°–¢–£–ü –ö ChatGPT</b><br><br>
        <span class="emoji">üëâ</span> –ë–µ–∑ —ç—Ç–æ–≥–æ —Å–º–æ—Ç—Ä–µ—Ç—å –∫—É—Ä—Å –¥–∞–ª—å—à–µ –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞, —Ç–∞–∫ –∫–∞–∫ –º—ã –±—É–¥–µ–º –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è –∏–º–µ–Ω–Ω–æ –≤ ChatGPT, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ<br><br>
        –í—ã–¥–µ–ª–∏ –≤—Ä–µ–º—è –∏ –ø–æ–ª—É—á–∏ –¥–æ—Å—Ç—É–ø –≤ ChatGPT –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è. –ü–æ–≤–µ—Ä—å, –∫–æ–≥–¥–∞ —Ç—ã –Ω–∞—á–Ω–µ—à—å –∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è - —Ç—ã –∫–∞–π—Ñ–æ–Ω–µ—à—å –∏ –≤—Å—ë –ø–æ–π–º–µ—à—å <span class="emoji">üôèüòå</span>`
      }
    ];

    let currentBlockIndex = 0;
    const totalBlocks = contentBlocks.length;
    let emptySpace = null;
    let isFirstBlockAdded = false;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ cookie
    function getUserId() {
      const match = document.cookie.match(/tg_user_id=([^;]+)/);
      return match ? match[1] : null;
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async function updateUserProgress() {
      const userId = getUserId();
      if (!userId) {
        console.error('User ID not found in cookies');
        return false;
      }

      try {
        // 1. –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
        const response = await fetch(
          `https://app.nocodb.com/api/${config.apiVersion}/db/data/${config.orgs}/${config.projectName}/${config.tableName}`,
          {
            headers: { 'xc-token': config.apiToken }
          }
        );

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        const userRecord = data.list.find(record => record.tg_user_id === userId);

        if (!userRecord) {
          console.error('User record not found');
          return false;
        }

        // 2. –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const updateResponse = await fetch(
          `https://app.nocodb.com/api/${config.apiVersion}/db/data/${config.orgs}/${config.projectName}/${config.tableName}/${userRecord.Id}`,
          {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'xc-token': config.apiToken
            },
            body: JSON.stringify({ progress: 2 })
          }
        );

        if (!updateResponse.ok) {
          throw new Error(`HTTP error! status: ${updateResponse.status}`);
        }

        console.log('Progress updated successfully');
        return true;

      } catch (error) {
        console.error('Error updating progress:', error);
        return false;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–æ–¥—É–ª—è
    async function completeModule() {
      const success = await updateUserProgress();
      if (success) {
        completionModal.classList.add('active');
      } else {
        alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
      }
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
    function addContentBlock(index) {
      if (index === 0 && isFirstBlockAdded) return;
      
      if (emptySpace) {
        emptySpace.remove();
        emptySpace = null;
      }

      const block = document.createElement('div');
      block.className = 'content-block';
      
      const title = document.createElement('h2');
      title.className = 'content-title';
      title.innerHTML = `${contentBlocks[index].title}`;
      block.appendChild(title);
      
      if (contentBlocks[index].image) {
        const img = document.createElement('img');
        img.className = 'content-image';
        img.src = `photo_course/${contentBlocks[index].image}`;
        img.alt = contentBlocks[index].title;
        block.appendChild(img);
      }
      
      const content = document.createElement('div');
      content.innerHTML = contentBlocks[index].content;
      block.appendChild(content);
      
      cardsContainer.appendChild(block);
      
      emptySpace = document.createElement('div');
      emptySpace.className = 'empty-space';
      cardsContainer.appendChild(emptySpace);
      
      if (index === 0) isFirstBlockAdded = true;
      
      setTimeout(() => {
        block.classList.add('visible');
        
        const headerHeight = document.querySelector('.header-bar').offsetHeight;
        const blockTop = block.offsetTop;
        
        window.scrollTo({
          top: blockTop - headerHeight,
          behavior: 'smooth'
        });
      }, 50);
    }

    function updateProgressBar() {
      const percent = ((currentBlockIndex + 1) / totalBlocks) * 100;
      progressBar.style.width = percent + '%';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    startBtn.addEventListener('click', () => {
      splash.classList.add('hide');
      setTimeout(() => {
        mainContent.classList.add('show');
        addContentBlock(0);
        updateProgressBar();
        nextBtn.classList.add('show');
      }, 300);
    });

    splashExitBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    nextBtn.addEventListener('click', () => {
      if (currentBlockIndex < totalBlocks - 1) {
        currentBlockIndex++;
        addContentBlock(currentBlockIndex);
        updateProgressBar();
        
        if (currentBlockIndex === 1) {
          nextBtn.classList.remove('centered');
          guideBtn.classList.add('show');
        }
        
        if (currentBlockIndex === totalBlocks - 1) {
          nextBtn.textContent = '–ó–∞–≤–µ—Ä—à–∏—Ç—å';
          nextBtn.onclick = completeModule;
        }
      }
    });

    exitBtn.addEventListener('click', () => {
      exitModal.style.display = 'flex';
    });

    modalExitBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    modalStayBtn.addEventListener('click', () => {
      exitModal.style.display = 'none';
    });

    guideBtn.addEventListener('click', () => {
      window.open('https://kurl.ru/btRup', '_blank');
    });

    reportBtn.addEventListener('click', () => {
      alert('–°–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è');
    });

    completionBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (!isFirstBlockAdded) {
      addContentBlock(0);
    }
  </script>
</body>
</html>
